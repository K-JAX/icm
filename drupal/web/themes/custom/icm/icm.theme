<?php
/**
 * Theme hooks
 */
// use Drupal\Core\Session;

//  Producing a better template suggest for pages
function icm_theme_suggestions_page_alter(array &$suggestions, array $variables) 
{
    if( isset($variables['page']['#title']) ){
        $request = \Drupal::request();
        $route_match = \Drupal::routeMatch();
        $page_title = \Drupal::service('title_resolver')->getTitle($request, $route_match->getRouteObject());
        $name = format_suggestion_name($page_title);
        $suggestions[] = 'page__' . $name;
    }

}

// // Producing a better name for my custom blocks so that I don't have to use suggestion based on ID
// function icm_theme_suggestions_block_alter(array &$suggestions, array $variables)
// {

//     if ( isset($variables['elements']['#configuration']['label']) ){
//         $blockName     = format_suggestion_name($variables['elements']['#configuration']['label']);
//         $suggestions[] = 'block__' . $blockName;
//     }
// }

function icm_theme_suggestions_views_view_unformatted_alter(array &$suggestions, array $variables, $hook) {
    if(isset($variables['view']->filter['type']->value)){
        if(reset($variables['view']->filter['type']->value) == 'left_right_brain_investing_stat'){
            // kint($variables['view']);
            $suggestions[] = 'views_view_unformatted__left_right';
        }    
    }
}

function icm_theme_suggestions_views_view_field_alter(array &$suggestions, array $variables, $hook) {

    // if($variables['view']->id() == 'left_brain_stats_list'){
    if(isset($variables['view']->filter['type']->value)){

        if(reset($variables['view']->filter['type']->value) == 'left_right_brain_investing_stat'){
            // kint(reset($variables['view']->filter['type']->value));
            $suggestions[] = 'views_view_field__left_right_' . $variables['field']->field;
        }
        if(reset($variables['view']->filter['type']->value) == 'advisor_service_square'){
            $suggestions[] = 'views_view_field__advisor_service_' . $variables['field']->field;
        }
    }
  }

use Symfony\Component\HttpFoundation\Cookie;
// // Creating variable based on cookie so that I can change content based on userType of anonymous users
function icm_preprocess_page(&$variables){
		
		$route_name = \Drupal::routeMatch()->getRouteName();

		if( $route_name == 'user.register'){
			user_cookie_save(array('userType' => 'banana'));
		}
		// kint($_COOKIE);


//     \Drupal::service('page_cache_kill_switch')->trigger();
//     // $cookie = Session::getCookie('userType');
//     // kint($cookie);
//     // $build['#cache']['max-age'] = 0;
//     // $variables['#cache']['max-age'] = 0;
//     // \Drupal::service('page_cache_kill_switch')->trigger();

//     // if ( !isset($variables["userType"]) && isset($_COOKIE["userType"]) ) {
//     //     $variables["userType"] = $_COOKIE["userType"];
//     // }
}

function format_suggestion_name( $name )
{
    $lCaseName     = strtolower($name);
    $final_name     = str_replace(' ', '_', str_replace("'", '', $lCaseName));
    return $final_name;
}
